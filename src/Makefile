# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
#                                                                           #
#    src/Makefile для проекта e_math                                        #
#    (c) T. Enikeev                                                         #
#    enikeev.tg@gmail.com                                                   #
#                                                                           #
#    Для справки:                                                           #
#    $@ Имя цели обрабатываемого правила                                    #
#    $< Имя первой зависимости обрабатываемого правила                      #
#    $^ Список всех зависимостей обрабатываемого правила                    #
#    $(SRC:.c=.o) - renaming SRC *.c -> *.o                                 #
#    $(^:.c=.o) - Список всех зависимостей обрабатываемого правила          #
#                 c переименованием расширений *.c -> *.o                   #
#                                                                           #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #

CC = gcc
AR = ar rc
RM = rm -f

CF = -Wall -Werror -Wextra
STD = -std=c11 -pedantic
ASAN = -g -fsanitize=address

LIB = e_math.a
SRC = main.c e_math.c
OBJ = $(SRC:.c=.o)
EXE = run_test

all: clean build

build: $(LIB) main.o 
	$(CC) main.o -L. $(LIB) -o $(EXE)

main.o:
	$(CC) $(CF) $(STD) main.c -c

$(LIB): e_math.o e_math_lib.o
	$(AR) lib_$@ $^

e_math.o:
	$(CC) $(CF) $(STD) e_math.c -c

e_math_lib.o:
	$(CC) $(CF) $(STD) e_math_lib/*.c -c ./e_math_lib

style:
	clang-format -style=google -i *.h *.c

clean:
	$(RM) *.o *.a $(EXE)

# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
#                                                                           #
#    Справка по созданию статической библиотеки:                            #
#    -L$(COM) - опция -L и адрес каталога относительно Makefile,            #
#              где при компоновке искать файл библиотеки                    #
#    -lmylib - опция -l и имя файла библиотеки libmylib.a без расширения и  #
#              префикса lib для подключения библиотеки к программе          #
#                                                                           #
#    ar - вызов архиватора для создания архива, который может подключаться  #
#         к программе во время компоновки на правах библиотеки              #
#    Опции архиватора:                                                      #
#    r - cоздаёт архив, добавляет или заменяет файлы в существующем архиве  #
#    x - извлекаются файлы из архива                                        #
#    c - приостанавливает вывод сообщений о том, что создаётся библиотека   #
#    v - включается режим подробных сообщений                               #
#                                                                           #
#    ranlib - пocтpoeниe oглaвлeния библиoтeки                              #
#                                                                           #
# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #
